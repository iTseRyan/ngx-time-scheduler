!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("rxjs"),require("moment"),require("@angular/common"),require("@angular/cdk/drag-drop")):"function"==typeof define&&define.amd?define("ngx-time-scheduler",["exports","@angular/core","rxjs","moment","@angular/common","@angular/cdk/drag-drop"],e):e((t=t||self)["ngx-time-scheduler"]={},t.ng.core,t.rxjs,t.moment_,t.ng.common,t.ng.cdk.dragDrop)}(this,(function(t,e,i,n,o,s){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function r(t,e,i,n){var o,s=arguments.length,r=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,n);else for(var c=t.length-1;c>=0;c--)(o=t[c])&&(r=(s<3?o(r):s>3?o(e,i,r):o(e,i))||r);return s>3&&r&&Object.defineProperty(e,i,r),r}function c(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}Object.create;function a(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],n=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}Object.create;var d=function(){function t(){this.item=new i.Subject,this.itemAdd=new i.Subject,this.itemId=new i.Subject,this.sectionAdd=new i.Subject,this.section=new i.Subject,this.sectionId=new i.Subject,this.refreshView=new i.Subject}return t.prototype.itemPush=function(t){this.itemAdd.next(t)},t.prototype.itemPop=function(){this.item.next()},t.prototype.itemRemove=function(t){this.itemId.next(t)},t.prototype.sectionPush=function(t){this.sectionAdd.next(t)},t.prototype.sectionPop=function(){this.section.next()},t.prototype.sectionRemove=function(t){this.sectionId.next(t)},t.prototype.refresh=function(){this.refreshView.next()},t.ɵprov=e.ɵɵdefineInjectable({factory:function(){return new t},token:t,providedIn:"root"}),t=r([e.Injectable({providedIn:"root"}),c("design:paramtypes",[])],t)}(),h=function(){},m=function(){},p=function(){},u=function(){this.NextButton="Next",this.PrevButton="Prev",this.TodayButton="Today",this.GotoButton="Go to",this.SectionTitle="Section"},l=function(){},f=function(){this.itemMetas=new Array},y=function(){this.cssTop=0,this.cssLeft=0,this.cssWidth=0},g=function(){this.headerDetails=new Array},b=function(){},v=n,w=function(){function t(t,e){var n=this;this.changeDetector=t,this.service=e,this.currentTimeFormat="DD-MMM-YYYY HH:mm",this.showCurrentTime=!0,this.showGoto=!0,this.showToday=!0,this.allowDragging=!1,this.locale="",this.showBusinessDayOnly=!1,this.headerFormat="Do MMM YYYY",this.minRowHeight=40,this.maxHeight=null,this.text=new u,this.events=new l,this.start=v().startOf("day"),this.end=v().endOf("day"),this.showGotoModal=!1,this.currentTimeVisibility="visible",this.ShowCurrentTimeHandle=null,this.SectionLeftMeasure="0",this.currentPeriodMinuteDiff=0,this.subscription=new i.Subscription,this.showCurrentTimeIndicator=function(){n.ShowCurrentTimeHandle&&clearTimeout(n.ShowCurrentTimeHandle);var t=v();t>=n.start&&t<=n.end?(n.currentTimeVisibility="visible",n.currentTimeIndicatorPosition=Math.abs(n.start.diff(t,"minutes"))/n.currentPeriodMinuteDiff*100+"%",n.currentTimeTitle=t.format(n.currentTimeFormat)):n.currentTimeVisibility="hidden",n.ShowCurrentTimeHandle=setTimeout(n.showCurrentTimeIndicator,3e4)},v.locale(this.locale)}return Object.defineProperty(t.prototype,"SectionTd",{set:function(t){this.SectionLeftMeasure=t.nativeElement.clientWidth+"px",this.changeDetector.detectChanges()},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){this.setSectionsInSectionItems(),this.changePeriod(this.periods[0],!1),this.itemPush(),this.itemPop(),this.itemRemove(),this.sectionPush(),this.sectionPop(),this.sectionRemove(),this.refresh()},t.prototype.refreshView=function(){this.setSectionsInSectionItems(),this.changePeriod(this.currentPeriod,!1)},t.prototype.trackByFn=function(t,e){return t},t.prototype.setSectionsInSectionItems=function(){var t=this;this.sectionItems=new Array,this.sections.forEach((function(e){var i=new f;i.section=e,i.minRowHeight=t.minRowHeight,t.sectionItems.push(i)}))},t.prototype.setItemsInSectionItems=function(){var t=this,e=new Array;this.sectionItems.forEach((function(i){i.itemMetas=new Array,i.minRowHeight=t.minRowHeight,t.items.filter((function(n){var o=new y;n.sectionID===i.section.id&&(o.item=n,o.item.start<=t.end&&o.item.end>=t.start&&(o=t.itemMetaCal(o),i.itemMetas.push(o),e.push(o)))}))}));var i=e.reduce((function(e,i){var n=t.sectionItems.findIndex((function(t){return t.section.id===i.item.sectionID}));return e[n]||(e[n]=[]),e[n].push(i),e}),{});this.calCssTop(i)},t.prototype.itemMetaCal=function(t){var e=v.max(t.item.start,this.start),i=v.min(t.item.end,this.end),n=Math.abs(e.diff(i,"minutes")),o=e.diff(this.start,"minutes");return this.showBusinessDayOnly&&(n-=this.getNumberOfWeekendDays(v(e),v(i))*this.currentPeriod.timeFramePeriod,o-=this.getNumberOfWeekendDays(v(this.start),v(e))*this.currentPeriod.timeFramePeriod),t.cssLeft=o/this.currentPeriodMinuteDiff*100,t.cssWidth=n/this.currentPeriodMinuteDiff*100,t.item.start>=this.start&&(t.isStart=!0),t.item.end<=this.end&&(t.isEnd=!0),t},t.prototype.calCssTop=function(t){var e,i;try{for(var n=a(Object.keys(t)),o=n.next();!o.done;o=n.next())for(var s=o.value,r=0;r<t[s].length;r++){for(var c=void 0,d=t[s][r],h=0;h<r;h++){var m=t[s][h],p=m.cssTop+this.minRowHeight;c=d.cssTop+this.minRowHeight,(m.item.start<=d.item.start&&d.item.start<=m.item.end||m.item.start<=d.item.end&&d.item.end<=m.item.end||m.item.start>=d.item.start&&d.item.end>=m.item.end)&&(m.cssTop<=d.cssTop&&d.cssTop<=p||m.cssTop<=c&&c<=p)&&(d.cssTop=p+1)}c=d.cssTop+this.minRowHeight+1,this.sectionItems[Number(s)]&&c>this.sectionItems[Number(s)].minRowHeight&&(this.sectionItems[Number(s)].minRowHeight=c)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(i=n.return)&&i.call(n)}finally{if(e)throw e.error}}},t.prototype.changePeriod=function(t,e){var i=this;void 0===e&&(e=!0),this.currentPeriod=t;var n=this.start;this.end=v(n).add(this.currentPeriod.timeFrameOverall,"minutes").endOf("day"),this.currentPeriodMinuteDiff=Math.abs(this.start.diff(this.end,"minutes")),e&&this.events.PeriodChange&&this.events.PeriodChange(this.start,this.end),this.showBusinessDayOnly&&(this.currentPeriodMinuteDiff-=this.getNumberOfWeekendDays(v(this.start),v(this.end))*this.currentPeriod.timeFramePeriod),this.header=new Array,this.currentPeriod.timeFrameHeaders.forEach((function(t,e){i.header.push(i.getDatesBetweenTwoDates(t,e))})),this.setItemsInSectionItems(),this.showCurrentTimeIndicator()},t.prototype.gotoToday=function(){this.start=v().startOf("day"),this.changePeriod(this.currentPeriod)},t.prototype.nextPeriod=function(){this.start.add(this.currentPeriod.timeFrameOverall,"minutes"),this.changePeriod(this.currentPeriod)},t.prototype.previousPeriod=function(){this.start.subtract(this.currentPeriod.timeFrameOverall,"minutes"),this.changePeriod(this.currentPeriod)},t.prototype.gotoDate=function(t){this.showGotoModal=!1,this.start=v(t).startOf("day"),this.changePeriod(this.currentPeriod)},t.prototype.getDatesBetweenTwoDates=function(t,e){for(var i,n=v(this.start),o=new g,s=0;n.isBefore(this.end)||n.isSame(this.end);){if(!this.showBusinessDayOnly||0!==n.day()&&6!==n.day()){var r=new b;r.name=n.locale(this.locale).format(t),i&&i!==r.name?s=1:(s++,o.headerDetails.pop()),i=r.name,r.colspan=s,r.tooltip=this.currentPeriod.timeFrameHeadersTooltip&&this.currentPeriod.timeFrameHeadersTooltip[e]?n.locale(this.locale).format(this.currentPeriod.timeFrameHeadersTooltip[e]):"",o.headerDetails.push(r)}n.add(this.currentPeriod.timeFramePeriod,"minutes")}return o},t.prototype.getNumberOfWeekendDays=function(t,e){for(var i=0;t.isBefore(e)||t.isSame(e);)0!==t.day()&&6!==t.day()||i++,t.add(this.currentPeriod.timeFramePeriod,"minutes");return i},t.prototype.drop=function(t){t.item.data.sectionID=t.container.data.id,this.refreshView(),this.events.ItemDropped(t.item.data)},t.prototype.itemPush=function(){var t=this;this.subscription.add(this.service.itemAdd.asObservable().subscribe((function(e){t.items.push(e),t.refreshView()})))},t.prototype.itemPop=function(){var t=this;this.subscription.add(this.service.item.asObservable().subscribe((function(){t.items.pop(),t.refreshView()})))},t.prototype.itemRemove=function(){var t=this;this.subscription.add(this.service.itemId.asObservable().subscribe((function(e){t.items.splice(t.items.findIndex((function(t){return t.id===e})),1),t.refreshView()})))},t.prototype.sectionPush=function(){var t=this;this.subscription.add(this.service.sectionAdd.asObservable().subscribe((function(e){t.sections.push(e),t.refreshView()})))},t.prototype.sectionPop=function(){var t=this;this.subscription.add(this.service.section.asObservable().subscribe((function(){t.sections.pop(),t.refreshView()})))},t.prototype.sectionRemove=function(){var t=this;this.subscription.add(this.service.sectionId.asObservable().subscribe((function(e){t.sections.splice(t.sections.findIndex((function(t){return t.id===e})),1),t.refreshView()})))},t.prototype.refresh=function(){var t=this;this.subscription.add(this.service.refreshView.asObservable().subscribe((function(){t.refreshView()})))},t.prototype.ngOnDestroy=function(){this.subscription&&this.subscription.unsubscribe()},t.ctorParameters=function(){return[{type:e.ChangeDetectorRef},{type:d}]},r([e.ViewChild("sectionTd"),c("design:type",e.ElementRef),c("design:paramtypes",[e.ElementRef])],t.prototype,"SectionTd",null),r([e.Input(),c("design:type",Object)],t.prototype,"currentTimeFormat",void 0),r([e.Input(),c("design:type",Object)],t.prototype,"showCurrentTime",void 0),r([e.Input(),c("design:type",Object)],t.prototype,"showGoto",void 0),r([e.Input(),c("design:type",Object)],t.prototype,"showToday",void 0),r([e.Input(),c("design:type",Object)],t.prototype,"allowDragging",void 0),r([e.Input(),c("design:type",Object)],t.prototype,"locale",void 0),r([e.Input(),c("design:type",Object)],t.prototype,"showBusinessDayOnly",void 0),r([e.Input(),c("design:type",Object)],t.prototype,"headerFormat",void 0),r([e.Input(),c("design:type",Object)],t.prototype,"minRowHeight",void 0),r([e.Input(),c("design:type",String)],t.prototype,"maxHeight",void 0),r([e.Input(),c("design:type",Object)],t.prototype,"text",void 0),r([e.Input(),c("design:type",Array)],t.prototype,"items",void 0),r([e.Input(),c("design:type",Array)],t.prototype,"sections",void 0),r([e.Input(),c("design:type",Array)],t.prototype,"periods",void 0),r([e.Input(),c("design:type",l)],t.prototype,"events",void 0),r([e.Input(),c("design:type",Object)],t.prototype,"start",void 0),t=r([e.Component({selector:"ngx-ts[items][periods][sections]",template:'<div class="time-sch-wrapper" [style.height]="maxHeight">\n  <div class="time-sch-header-wrapper mb-1">\n    <div class="time-sch-period-container">\n      <button class="btn"\n              *ngFor="let period of periods"\n              [ngClass]="period.classes"\n              (click)="changePeriod(period)"\n              [title]="period.tooltip? period.tooltip : \'\'"\n      >\n        {{period.name}}\n      </button>\n    </div>\n\n    <div class="time-sch-time-container">\n      <button class="btn" *ngIf="showGoto" (click)="showGotoModal = !showGotoModal">{{text.GotoButton}}</button>\n      <div class="goto-modal" *ngIf="showGotoModal">\n        <label>\n          <input type="date" (change)="gotoDate($event.target.value)">\n        </label>\n      </div>\n\n      <button class="btn" *ngIf="showToday" (click)="gotoToday()">{{text.TodayButton}}</button>\n      <button class="btn" (click)="previousPeriod()">{{text.PrevButton}}</button>\n      <button class="btn" (click)="nextPeriod()">{{text.NextButton}}</button>\n    </div>\n\n    <h3 class="text-center m-0">\n      {{ start.locale(locale).format(headerFormat) + \' - \' + end.locale(locale).format(headerFormat)}}\n    </h3>\n  </div>\n\n  <div class="time-sch-table-wrapper">\n    <table class="time-sch-table">\n      <tr *ngFor="let timeFrameHeader of header; let i = index; trackBy: trackByFn">\n\n        <td class="time-sch-section text-center" *ngIf="i === 0" [rowSpan]="periods.length">\n          {{text.SectionTitle}}\n        </td>\n\n        <td class="text-center"\n            *ngFor="let dateTime of timeFrameHeader.headerDetails; trackBy: trackByFn"\n            [colSpan]="dateTime.colspan"\n            [title]="dateTime.tooltip? dateTime.tooltip : \'\'"\n        >\n          {{dateTime.name}}\n        </td>\n\n      </tr>\n    </table>\n\n    <div class="time-sch-content-wrap">\n      <table class="time-sch-table">\n        <tr *ngFor="let sectionItem of sectionItems; trackBy: trackByFn"\n            [style.height]="sectionItem.minRowHeight + \'px\'">\n          <td class="time-sch-section text-center" #sectionTd\n              (click)="events.SectionClickEvent ? events.SectionClickEvent(sectionItem.section) : false"\n              (contextmenu)="events.SectionContextMenuEvent ? events.SectionContextMenuEvent(sectionItem.section, $event) : false"\n              [style.cursor]="events.SectionClickEvent ? \'pointer\' : \'\'"\n              [title]="sectionItem.section.tooltip? sectionItem.section.tooltip : \'\'"\n          >\n            {{sectionItem.section.name}}\n          </td>\n\n          <td *ngFor="let td of header[header.length - 1].headerDetails; trackBy: trackByFn"></td>\n        </tr>\n      </table>\n\n      <div class="time-sch-section-wrapper" [style.left]="SectionLeftMeasure" cdkDropListGroup>\n        <div class="time-sch-section-container"\n             cdkDropList\n             cdkDropListSortingDisabled\n             [cdkDropListData]="sectionItem.section"\n             (cdkDropListDropped)="drop($event)"\n             *ngFor="let sectionItem of sectionItems; trackBy: trackByFn"\n             [style.height]="sectionItem.minRowHeight + \'px\'"\n        >\n          <div class="time-sch-item"\n               cdkDrag\n               cdkDragLockAxis="y"\n               cdkDragBoundary=".time-sch-section-wrapper"\n               [cdkDragData]="itemMeta.item"\n               [cdkDragDisabled]="!allowDragging"\n               *ngFor="let itemMeta of sectionItem.itemMetas"\n               [ngClass]="itemMeta.item.classes"\n               (click)="events.ItemClicked ? events.ItemClicked(itemMeta.item) : false"\n               (contextmenu)="events.ItemContextMenu ? events.ItemContextMenu(itemMeta.item, $event) : false"\n               [style.height]="minRowHeight + \'px\'"\n               [style.top]="itemMeta.cssTop + \'px\'"\n               [style.left]="itemMeta.cssLeft + \'%\'"\n               [style.width]="itemMeta.cssWidth + \'%\'"\n          >\n            <div class="item-drag-placeholder"\n                 *cdkDragPlaceholder\n                 [style.height]="(minRowHeight - 6) + \'px\'"\n                 [style.left]="itemMeta.cssLeft + \'%\'"\n                 [style.width]="\'calc(\'+ itemMeta.cssWidth + \'% - 6px)\'"\n            ></div>\n            <div class="time-sch-item-start" *ngIf="itemMeta.isStart"></div>\n            <div class="time-sch-item-content"\n                 [title]="itemMeta.item.tooltip? itemMeta.item.tooltip : \'\'">\n              {{itemMeta.item.name}}\n            </div>\n            <div class="time-sch-item-end" *ngIf="itemMeta.isEnd"></div>\n          </div>\n        </div>\n\n        <div class="time-sch-current-time"\n             *ngIf="showCurrentTime"\n             [title]="currentTimeTitle"\n             [style.visibility]="currentTimeVisibility"\n             [style.left]="currentTimeIndicatorPosition"\n        ></div>\n      </div>\n\n    </div>\n  </div>\n</div>\n',styles:[".d-inline-block{display:inline-block!important}.text-center{text-align:center!important}.m-0{margin:0!important}.mb-1{margin-bottom:1rem!important}.btn{border:1px solid #e1e1e1;font-weight:600;text-decoration:none;color:#222;height:30px;padding:.5em 1em;cursor:pointer;margin:.2rem;border-radius:4px}.goto-modal{position:absolute;top:100%;left:0;height:auto;width:auto;border-radius:4px;background-color:#ddd;padding:5px;text-align:left;z-index:1}.time-sch-wrapper{overflow:auto}.time-sch-header-wrapper,.time-sch-table-wrapper,.time-sch-wrapper{position:relative}.time-sch-header-wrapper{padding:.5em;margin-bottom:.5em}.time-sch-table{width:100%;table-layout:fixed;border-collapse:collapse;border-spacing:0}.time-sch-period-container{float:left;position:relative}.time-sch-time-container{float:right;position:relative}.time-sch-wrapper .time-sch-section{width:200px}.time-sch-wrapper td,.time-sch-wrapper th{border-width:1px;border-style:solid;border-color:#e1e1e1 #c1c1c1}.time-sch-content-wrap{position:relative}.time-sch-section-wrapper{position:absolute;top:0;right:0;bottom:0;z-index:1;padding-left:1px;padding-right:1px}.time-sch-section-container{position:relative;overflow:hidden}.time-sch-item{position:absolute;min-height:1em;clear:both;background-color:#29d;color:#fff;border-radius:2px;cursor:pointer;transition:background-color .1s;border:1px solid #c1c1c1}.time-sch-item-content{overflow:hidden;white-space:nowrap;position:relative;z-index:1;padding:4px 0 4px 6px}.time-sch-item-end,.time-sch-item-start{position:absolute;top:2px;bottom:2px}.time-sch-item-start{left:1px;border-right:2px dotted #fff}.time-sch-item-end{right:1px;border-left:2px dotted #fff}.time-sch-current-time{position:absolute;top:0;bottom:0;z-index:2;background:0 0;border-left:1px dotted #000}.item-drag-placeholder{position:absolute;background:#ccc;border:3px dotted #999;transition:transform 250ms cubic-bezier(0,0,.2,1)}"]}),c("design:paramtypes",[e.ChangeDetectorRef,d])],t)}(),x=function(){function t(){}return t=r([e.NgModule({declarations:[w],imports:[o.CommonModule,s.DragDropModule],exports:[w]})],t)}();t.Events=l,t.Header=g,t.HeaderDetails=b,t.Item=m,t.ItemMeta=y,t.NgxTimeSchedulerComponent=w,t.NgxTimeSchedulerModule=x,t.NgxTimeSchedulerService=d,t.Period=h,t.Section=p,t.SectionItem=f,t.Text=u,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=ngx-time-scheduler.umd.min.js.map